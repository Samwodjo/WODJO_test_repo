---
title: "Our mini project WKC"
author: "Chidimma"
date: "2025-02-13"
output: html_document
---

# loading relevant libraries
```{r}
library(dplyr)
library(ggplot2)
library(car)
library(MASS)
library(reticulate)
```


```{r}
mat_data <- read.csv("C:\\Users\\user\\Downloads\\Re_ WASHA Takwimu mini project\\Maternal Health Risk Data Set.csv")
```
 
# Some data wrangling
```{r}
head(mat_data)

# subsetting with filter
filter(mat_data, RiskLevel == 'high risk')

# Selecting columns with select
#mat_data2 <- select(mat_data, Age, DiastolicBP, RiskLevel)
#head(mat_data2)
##filter(mat_data2, Age <= 20 )

# summarize data
mat_data %>% summarize(avg = mean(Age))
mat_data %>% summarize(avg = median(DiastolicBP))
```

# Question 1: Group the data by risk level (i) Mean age per risk level - descending)
```{r}
mat_data %>% 
  group_by(RiskLevel) %>% 
  summarise(Mean_Age = mean(Age, na.rm = TRUE)) %>% 
  arrange(desc(Mean_Age))
```

# Q1(ii) Median diastiolic per risk level (ascending)
```{r}
mat_data %>% 
  group_by(RiskLevel) %>% 
  summarise(Median_Diastolic = median(DiastolicBP, na.rm = TRUE)) %>% 
  arrange(Median_Diastolic)
```

# Question 2.	Create a new variable name it systolic rate
```{r}
mat_data <- mat_data %>% mutate(SystolicRate = SystolicBP / Age)
head(mat_data)
```
# Question	3.	Filter participants of age <= 40 years
```{r}
mat_data %>% filter(Age <= 40) %>%
  group_by(RiskLevel) %>%
  summarise(Mean_SystolicRate = mean(SystolicRate, na.rm = TRUE))

```

# Question 4a.	Data visualization using python
```{r}
#use_python("C:\\Users\\user\\anaconda3\\conda-meta\\python-3.12.7-h14ffc60_0.json")
use_python("C:/Users/user/anaconda3/python.exe", required = TRUE)
py_run_string('
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

mat_data2 = pd.read_csv("C:/Users/user/Downloads/Re_ WASHA Takwimu mini project/Maternal Health Risk Data Set.csv")
mat_cont_vars = ["SystolicBP", "DiastolicBP", "BS", "BodyTemp", "HeartRate"]

# Histograms
for var in mat_cont_vars:
    plt.figure()
    sns.histplot(mat_data2[var], bins=30, kde=True, color="blue")
    plt.title(f"Histogram of {var}")
    plt.show()

# Boxplots
for var in mat_cont_vars:
    plt.figure()
    sns.boxplot(x=mat_data2["RiskLevel"], y=mat_data2[var], palette="deep")
    plt.title(f"Boxplot of {var} by Risk Level")
    plt.show()
')
```


# Question 4a.	Data visualization using R
```{r}
#hist(mat_data$DiastolicBP)
mat_cont_vars <- c("SystolicBP", "DiastolicBP", "BS", "BodyTemp", "HeartRate")
for (var in mat_cont_vars) {
print(ggplot(mat_data, aes(x = .data[[var]])) + 
       geom_histogram(fill = "blue", color = "black", bins = 30) + 
       ggtitle(paste("Histogram of", var)))
 print(ggplot(mat_data, aes(x = RiskLevel, y = .data[[var]])) + 
       geom_boxplot(fill = "orange") + 
        ggtitle(paste("Boxplot of", var, "by Risk Level")))
}
```


# Question 4b. Summary Statistics
```{r}
# summary grouped by risk level
 mat_data %>%
  group_by(RiskLevel) %>% 
  summarise(across(all_of(mat_vars), 
                   list(Min = min, 
                        Q1 = ~quantile(.x, 0.25, na.rm = TRUE), 
                        Median = median, 
                        Q3 = ~quantile(.x, 0.75, na.rm = TRUE), 
                        Max = max), 
                   .names = "{.col}_{.fn}"))
## how can we rearrange the table
```

# Question 5.	Exploring relationships between Heart Rate and other variables
```{r}
plot_list <- list(
  ggplot(mat_data, aes(x = Age, y = HeartRate)) + 
    geom_point() + 
    geom_smooth(method = "lm", col = "red") + 
    ggtitle("Heart Rate vs Age"),
  
  ggplot(mat_data, aes(x = SystolicBP, y = HeartRate)) + 
    geom_point() + 
    geom_smooth(method = "lm", col = "red") + 
    ggtitle("Heart Rate vs Systolic BP"),
  
  ggplot(mat_data, aes(x = DiastolicBP, y = HeartRate)) + 
    geom_point() + 
    geom_smooth(method = "lm", col = "red") + 
    ggtitle("Heart Rate vs Diastolic BP"),
  
  ggplot(mat_data, aes(x = BodyTemp, y = HeartRate)) + 
    geom_point() + 
    geom_smooth(method = "lm", col = "red") + 
    ggtitle("Heart Rate vs Body Temperature")
)

# Print scatter plots
walk(plot_list, print)
```


```{r}
names(mat_data)
```

```{r}
slm_model1 <- lm(HeartRate ~ Age, data = mat_data)
summary(slm_model1)
slm_model2 <- lm(HeartRate ~ SystolicBP, data = mat_data)
summary(slm_model2)
slm_model3 <- lm(HeartRate ~ DiastolicBP, data = mat_data)
summary(slm_model3)
slm_model4 <- lm(HeartRate ~ BodyTemp, data = mat_data)
summary(slm_model4)
```

# Question 5b.	Simple linear regression model
```{r}
slm_model <- lm(HeartRate ~ Age + SystolicBP + DiastolicBP + BodyTemp, data = mat_data)
summary(slm_model)
```

# Question 6. Multiple Linear Regression with Stepwise Selection
```{r}
#full_model <- lm(HeartRate ~ Age + SystolicBP + DiastolicBP + BodyTemp, data = mat_data)
#fitstart <- lm(HeartRate~1, data=mat_data)
stepwise_model <- stepAIC(full_model, direction = "both")
#summary(fitstart)
#summary(full_model)
summary(stepwise_model)
```















##Residual analysis


```{r}
install.packages("car")
install.packages("carData ")
library(car)
library(carData)


```{r}
vif(residual)
```

```{r}
residual<-stepwisemodel$residuals
plot(dd$Age,residual)
```
```{r}
residual<-stepwisemodel$residuals
plot(dd$SystolicBP,residual)
```

```{r}
residual<-stepwisemodel$residuals
plot(dd$DiastolicBP,residual)
```

```{r}
residual<-stepwisemodel$residuals
plot(dd$BodyTemp,residual)
```

```{r}
plot(stepwisemodel,which=1,col=c("blue"))
```




```{r}
plot(residual)
```


```{r}
t.test(residual)
```
Ho:residual mean is equal to zero
H1:residual mean is not equal to zero.
since our p-value of 1 is greater than our alpha value of 0.05, we fail to reject the null hypothesis and conclude that the residual mean is equal to zero. 


```{r}
library(lmtest)
```

###Test of constant variance

```{r}
plot(residual)
```
from the residual plot above,it appears the residuals are homoscedastic, but we need to confirm this by conducting the BRUESCH PAGAN test. 

```{r}
bptest(stepwisemodel)
```
Ho: homoscedastic
H1:heteroscedastic
since our p-value(0.04686) is less than an alpha value of 0.05,we reject the null hypothesis and conclude that there is heteroscedasticity.


##Residual test of independence
```{r}
dwtest(stepwisemodel)
```

Ho:there is no residual autocorrelation 
H1:there is residual autocorrelation
since our p-value(0.9476) is greater than an alpha value of 0.05,we fail to reject the null hypothesis and conclude that there is no autocorrelation among the residuals.
we will however proceed to plot the autocorrelation function (acf) to confirm.


```{r}
acf(residual)
```

## test of normality of residuals.

```{r}
hist(residual)
```
from the histogram, it is not show clear whether the residuals are normally distributed or not, so we proceed to conduct the shapiro test of normality.

```{r}
shapiro.test(residual)
```

Ho:residuals are normally distributed
H1: residuals are not normally distributed

since the p-value (2.2e^-16) is less the (alpha=0.05),we reject the Ho and conclude that the residuals are not normally distributed. 





